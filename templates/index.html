<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Lingual OCR Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --bg: #f3f4f6; --text: #1f2937; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .card { max-width: 800px; margin: 40px auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header { text-align: center; margin-bottom: 30px; }

        .upload-area { border: 2px dashed #d1d5db; padding: 40px; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; }
        .upload-area:hover { border-color: var(--primary); background: #f5f3ff; }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .option-group { display: flex; flex-direction: column; gap: 8px; }
        select, button { padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; font-size: 1rem; }

        .btn-main { background: var(--primary); color: white; border: none; font-weight: 600; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn-main:hover { opacity: 0.9; }
        .btn-main:disabled { background: #9ca3af; cursor: not-allowed; }

        .preview-container { margin-top: 30px; display: none; }
        pre { background: #1e293b; color: #f8fafc; padding: 20px; border-radius: 8px; overflow-x: auto; white-space: pre-wrap; font-size: 14px; max-height: 400px; }

        .loader { display: none; margin: 20px auto; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="card">
    <div class="header">
        <h1>üñãÔ∏è OCR Pro</h1>
        <p>English & Hindi Handwriting / Image / PDF Extractor</p>
    </div>

    <div class="upload-area" id="dropZone">
        <i class="fas fa-file-upload fa-3x" style="color: var(--primary); margin-bottom: 10px;"></i>
        <p id="file-name">Drag & Drop or Click to Upload</p>
        <input type="file" id="fileInput" hidden>
    </div>

    <div class="options-grid">
        <div class="option-group">
            <label><strong>1. Language</strong></label>
            <select id="langSelect">
                <option value="eng+hin">English + Hindi (Mixed)</option>
                <option value="hin">Hindi Only</option>
                <option value="eng">English Only</option>
            </select>
        </div>
        <div class="option-group">
            <label><strong>2. Output Format</strong></label>
            <select id="formatSelect">
                <option value="txt">Text (.txt)</option>
                <option value="docx">Word (.docx)</option>
                <option value="csv">Excel/Data (.csv)</option>
                <option value="md">Markdown (.md)</option>
            </select>
        </div>
    </div>

    <button class="btn-main" id="startBtn" style="width: 100%;">
        <span>Process Document</span>
        <i class="fas fa-arrow-right"></i>
    </button>

    <div class="loader" id="loader"></div>

    <div class="preview-container" id="previewArea">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3>Extraction Preview</h3>
            <a id="downloadLink" class="btn-main" style="padding: 5px 15px; text-decoration: none; font-size: 0.8rem;">Download</a>
        </div>
        <pre id="textPreview"></pre>
    </div>
</div>

<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const startBtn = document.getElementById('startBtn');
    const loader = document.getElementById('loader');
    const previewArea = document.getElementById('previewArea');

    dropZone.onclick = () => fileInput.click();

    fileInput.onchange = () => {
        if(fileInput.files.length) document.getElementById('file-name').innerText = fileInput.files[0].name;
    };

    startBtn.onclick = async () => {
        if(!fileInput.files.length) return alert("Select a file");

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);
        formData.append('lang', document.getElementById('langSelect').value);
        formData.append('format', document.getElementById('formatSelect').value);

        loader.style.display = 'block';
        previewArea.style.display = 'none';
        startBtn.disabled = true;

        try {
            // Increased timeout handling via fetch
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 120000); // 2 minute timeout

            const response = await fetch('/process', {
                method: 'POST',
                body: formData,
                signal: controller.signal
            });

            const data = await response.json();
            clearTimeout(timeoutId);

            if(data.success) {
                document.getElementById('textPreview').innerText = data.preview;
                document.getElementById('downloadLink').href = data.download_url;
                previewArea.style.display = 'block';
            } else {
                alert(data.error);
            }
        } catch (e) {
            alert("Request timed out or connection lost. Large PDFs take longer to OCR.");
        } finally {
            loader.style.display = 'none';
            startBtn.disabled = false;
        }
    };
</script>
</body>
</html>
